# Development Dockerfile with hot reloading support
# Separates frontend and backend into different build targets

# ============================================================
# Backend Development Stage
# ============================================================
FROM python:3.11-slim as backend-dev

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc \
    postgresql-client \
    && rm -rf /var/lib/apt/lists/*

# Copy and install Python dependencies
COPY server/requirements.txt /app/server/requirements.txt
RUN pip install --no-cache-dir -r /app/server/requirements.txt

# Install Flask development extras
RUN pip install --no-cache-dir watchdog

# Copy server code (will be overridden by volume mount)
COPY server /app/server

# Expose port
EXPOSE 3003

# Use Flask's built-in development server with auto-reload
CMD ["python", "/app/server/app.py"]

# ============================================================
# Frontend Development Stage
# ============================================================
FROM node:20-alpine as frontend-dev

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install ALL dependencies (including devDependencies for Vite)
RUN npm install

# Copy source code (will be overridden by volume mounts for hot reload)
COPY . .

# Expose Vite dev server port
EXPOSE 5173

# Start Vite dev server with HMR
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]
